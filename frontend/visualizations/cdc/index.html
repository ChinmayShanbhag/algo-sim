<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Data Capture (CDC) Architecture</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="container">
        <nav class="top-nav">
            <a href="../../index.html" class="back-link">â† Back to Home</a>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <span class="theme-icon">ğŸŒ™</span>
            </button>
        </nav>
        <h1>Change Data Capture (CDC) Architecture</h1>
        
        <div id="controls">
            <div class="control-group">
                <h3>Database Operations</h3>
                <div class="controls-row">
                    <input type="text" id="name-input" placeholder="Name" class="input-field">
                    <input type="text" id="email-input" placeholder="Email" class="input-field">
                    <select id="status-select" class="input-field">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <button id="insert-btn" class="primary-button">INSERT</button>
                </div>
                <div class="controls-row">
                    <input type="text" id="update-id-input" placeholder="ID" class="input-field-small">
                    <input type="text" id="update-name-input" placeholder="Name" class="input-field">
                    <input type="text" id="update-email-input" placeholder="Email" class="input-field">
                    <select id="update-status-select" class="input-field">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                    <button id="update-btn" class="secondary-button">UPDATE</button>
                </div>
                <div class="controls-row">
                    <input type="text" id="delete-id-input" placeholder="ID to delete" class="input-field-small">
                    <button id="delete-btn" class="danger-button">DELETE</button>
                </div>
            </div>
            
            <div class="control-group">
                <h3>CDC Pipeline Control</h3>
                <div class="controls-row">
                    <button id="stream-btn" class="action-button">ğŸ“¤ Stream to Kafka</button>
                    <button id="consume-btn" class="action-button">ğŸ“¥ Consume from Kafka</button>
                    <button id="reset-btn" class="reset-button">Reset System</button>
                </div>
                <div id="feedback" class="feedback"></div>
            </div>
        </div>

        <div class="main-content">
            <div class="pipeline-container">
                <!-- Primary Database -->
                <div class="pipeline-stage" id="database-stage">
                    <h2>ğŸ—„ï¸ Primary Database</h2>
                    <div class="stage-content">
                        <div id="database-records" class="records-container"></div>
                        <div class="subsection">
                            <h4>Replication Log (WAL)</h4>
                            <div id="replication-log" class="log-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="pipeline-arrow">
                    <div class="arrow-label">CDC Connector</div>
                    <div class="arrow-line"></div>
                    <div class="arrow-head">â–¼</div>
                </div>

                <!-- Kafka Broker -->
                <div class="pipeline-stage" id="kafka-stage">
                    <h2>ğŸ“¨ Kafka Broker</h2>
                    <div class="stage-content">
                        <div class="subsection">
                            <h4>Topic: db.changes.users</h4>
                            <div id="kafka-messages" class="messages-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Arrow -->
                <div class="pipeline-arrow">
                    <div class="arrow-label">Consumers</div>
                    <div class="arrow-line"></div>
                    <div class="arrow-head">â–¼</div>
                </div>

                <!-- Derived Systems -->
                <div class="pipeline-stage" id="derived-stage">
                    <h2>ğŸ¯ Derived Systems</h2>
                    <div class="stage-content">
                        <div class="derived-systems-grid">
                            <div class="derived-system">
                                <h4>ğŸ” Search Index (Elasticsearch)</h4>
                                <div id="search-index" class="derived-container"></div>
                            </div>
                            <div class="derived-system">
                                <h4>âš¡ Cache (Redis)</h4>
                                <div id="cache" class="derived-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Panel -->
            <div id="stats-panel">
                <h2>ğŸ“Š Pipeline Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Total Changes</span>
                        <span id="stat-total" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Processed</span>
                        <span id="stat-processed" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Messages Sent</span>
                        <span id="stat-messages" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Search Indexed</span>
                        <span id="stat-search" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Cache Updated</span>
                        <span id="stat-cache" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg Latency</span>
                        <span id="stat-latency" class="stat-value">0ms</span>
                    </div>
                </div>
            </div>

            <!-- Explanation Panel -->
            <div id="explanation-panel">
                <h2>Understanding CDC Architecture</h2>
                <div class="explanation-content">
                    <h3>What is Change Data Capture? ğŸ“¸</h3>
                    <p>CDC is a design pattern that captures changes (inserts, updates, deletes) from a database and streams them to other systems in real-time. This enables building derived data systems that stay synchronized without polling or batch jobs.</p>

                    <h3>How It Works:</h3>
                    
                    <h4>1. Primary Database ğŸ—„ï¸</h4>
                    <ul>
                        <li><strong>Write-Ahead Log (WAL):</strong> Every change is first written to a log</li>
                        <li><strong>Replication Log:</strong> CDC reads from this log continuously</li>
                        <li><strong>Non-intrusive:</strong> No triggers or application changes needed</li>
                    </ul>

                    <h4>2. CDC Connector ğŸ”Œ</h4>
                    <ul>
                        <li><strong>Tail the Log:</strong> Reads new entries as they're written</li>
                        <li><strong>Parse Changes:</strong> Extracts operation type and data</li>
                        <li><strong>Transform:</strong> Converts to event format</li>
                    </ul>

                    <h4>3. Message Broker (Kafka) ğŸ“¨</h4>
                    <ul>
                        <li><strong>Durable Queue:</strong> Stores events reliably</li>
                        <li><strong>Partitioning:</strong> Distributes load across partitions</li>
                        <li><strong>Ordering:</strong> Maintains order within partitions</li>
                        <li><strong>Replay:</strong> Consumers can reprocess from any point</li>
                    </ul>

                    <h4>4. Derived Systems ğŸ¯</h4>
                    <ul>
                        <li><strong>Search Index:</strong> Full-text search (Elasticsearch)</li>
                        <li><strong>Cache:</strong> Fast access layer (Redis)</li>
                        <li><strong>Analytics DB:</strong> OLAP queries (ClickHouse)</li>
                        <li><strong>Data Warehouse:</strong> Historical analysis</li>
                    </ul>

                    <h3>Key Benefits:</h3>
                    <ul>
                        <li><strong>Real-time:</strong> Changes propagate in milliseconds</li>
                        <li><strong>Decoupled:</strong> Systems evolve independently</li>
                        <li><strong>Reliable:</strong> Guaranteed delivery with Kafka</li>
                        <li><strong>Scalable:</strong> Add consumers without impacting source</li>
                        <li><strong>Auditable:</strong> Complete history of all changes</li>
                    </ul>

                    <h3>Real-World Examples:</h3>
                    <ul>
                        <li><strong>LinkedIn:</strong> Powers search, recommendations, analytics</li>
                        <li><strong>Uber:</strong> Real-time trip updates, driver matching</li>
                        <li><strong>Netflix:</strong> Personalization, A/B testing</li>
                        <li><strong>Airbnb:</strong> Search indexing, pricing optimization</li>
                    </ul>

                    <h3>Popular CDC Tools:</h3>
                    <ul>
                        <li><strong>Debezium:</strong> Open-source CDC for various databases</li>
                        <li><strong>AWS DMS:</strong> Database Migration Service with CDC</li>
                        <li><strong>Confluent:</strong> Kafka-based CDC platform</li>
                        <li><strong>Maxwell:</strong> MySQL CDC to Kafka</li>
                    </ul>

                    <h3>Try It:</h3>
                    <ol>
                        <li>INSERT a new user record</li>
                        <li>Click "Stream to Kafka" to capture changes</li>
                        <li>Click "Consume from Kafka" to update derived systems</li>
                        <li>Try UPDATE and DELETE operations</li>
                        <li>Watch how changes flow through the pipeline!</li>
                    </ol>

                    <h3>ğŸ”§ Backend Simulation Architecture</h3>
                    <div class="backend-section">
                        <h4>System Components & Data Flow</h4>
                        
                        <div class="architecture-diagram">
                            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CDC SYSTEM ARCHITECTURE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRIMARY         â”‚         â”‚   REPLICATION    â”‚         â”‚   KAFKA     â”‚
â”‚  DATABASE        â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   LOG            â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   BROKER    â”‚
â”‚                  â”‚  Write  â”‚   (WAL/Binlog)   â”‚  Read   â”‚   (Topic)   â”‚
â”‚ - Users Table    â”‚         â”‚                  â”‚         â”‚             â”‚
â”‚ - Orders Table   â”‚         â”‚  LSN: 1001       â”‚         â”‚  Partitions â”‚
â”‚ - Products Table â”‚         â”‚  LSN: 1002       â”‚         â”‚  - user-db  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  LSN: 1003 ...   â”‚         â”‚  - orders   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                        â”‚                                              â”‚
                        v                                              v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   SEARCH INDEX      â”‚                       â”‚   CACHE (Redis)      â”‚
            â”‚   (Elasticsearch)   â”‚                       â”‚                      â”‚
            â”‚                     â”‚                       â”‚  - User:123 â†’ {...}  â”‚
            â”‚  - Full text search â”‚                       â”‚  - Order:456 â†’ {...} â”‚
            â”‚  - Fast queries     â”‚                       â”‚                      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
                        </div>

                        <div class="algorithm-impl">
                            <h5>1ï¸âƒ£ Primary Database Component</h5>
                            <pre><code>STRUCTURE PrimaryDatabase:
    tables: Map<TableName, List<Row>>  // Stores all tables and rows
    replicationLog: ReplicationLog     // Pointer to replication log
    LSN: Integer = 0                   // Log Sequence Number

FUNCTION ExecuteOperation(operation):
    // STEP 1: Apply change to database
    SWITCH operation.type:
        CASE "INSERT":
            tables[operation.table].append(operation.data)
        CASE "UPDATE":
            row = findRow(operation.table, operation.id)
            updateRow(row, operation.data)
        CASE "DELETE":
            removeRow(operation.table, operation.id)
    END SWITCH
    
    // STEP 2: Write to replication log (CRITICAL for CDC!)
    LSN = LSN + 1
    logEntry = {
        lsn: LSN,
        operation: operation.type,
        table: operation.table,
        data: operation.data,
        timestamp: getCurrentTime()
    }
    replicationLog.Append(logEntry)
    
    // STEP 3: Notify CDC connector
    replicationLog.NotifyConnector()
END FUNCTION

KEY POINT: Every write to database is also written to replication log
This ensures CDC never misses any changes!</code></pre>
                        </div>

                        <div class="algorithm-impl">
                            <h5>2ï¸âƒ£ Replication Log (Write-Ahead Log)</h5>
                            <pre><code>STRUCTURE ReplicationLog:
    entries: List<LogEntry>    // All log entries
    lastReadLSN: Integer = 0   // Last LSN read by CDC connector

STRUCTURE LogEntry:
    lsn: Integer
    operation: String  // "INSERT", "UPDATE", or "DELETE"
    table: String
    data: Object
    timestamp: DateTime

FUNCTION Append(entry):
    // Atomically add entry to log
    LOCK:
        entries.append(entry)
    END LOCK
END FUNCTION

FUNCTION ReadNew():
    // Return all entries since last read
    LOCK:
        newEntries = []
        FOR EACH entry IN entries:
            IF entry.lsn > lastReadLSN THEN
                newEntries.append(entry)
            END IF
        END FOR
        
        IF newEntries is not empty THEN
            lastReadLSN = newEntries[last].lsn
        END IF
        
        RETURN newEntries
    END LOCK
END FUNCTION

KEY POINT: Log is append-only and ordered by LSN
CDC reads incrementally without affecting database performance</code></pre>
                        </div>

                        <div class="algorithm-impl">
                            <h5>3ï¸âƒ£ CDC Connector (Continuous Polling)</h5>
                            <pre><code>STRUCTURE CDCConnector:
    replicationLog: ReplicationLog
    kafka: KafkaBroker
    isRunning: Boolean

FUNCTION Start():
    isRunning = true
    
    // Background process: Poll every 100ms
    SPAWN BACKGROUND THREAD:
        WHILE isRunning:
            SLEEP(100 milliseconds)
            
            // Read new entries from replication log
            newEntries = replicationLog.ReadNew()
            
            // Publish each entry to Kafka
            FOR EACH entry IN newEntries:
                changeEvent = {
                    lsn: entry.lsn,
                    operation: entry.operation,
                    table: entry.table,
                    before: null,        // Previous value (for UPDATE/DELETE)
                    after: entry.data,   // New value
                    timestamp: entry.timestamp
                }
                
                kafka.Publish("db-changes", changeEvent)
            END FOR
        END WHILE
    END THREAD
END FUNCTION

FUNCTION Stop():
    isRunning = false
END FUNCTION

KEY POINT: Continuously reads log without blocking database
Real-world tools (Debezium, Maxwell) read directly from DB binlog!</code></pre>
                        </div>

                        <div class="algorithm-impl">
                            <h5>4ï¸âƒ£ Kafka Broker (Message Queue)</h5>
                            <pre><code>STRUCTURE KafkaBroker:
    topics: Map<TopicName, List<Event>>      // Store events by topic
    consumers: Map<TopicName, List<Consumer>> // Track subscribers

FUNCTION Publish(topicName, event):
    LOCK:
        // Add event to topic
        topics[topicName].append(event)
        
        // Notify all subscribers
        FOR EACH consumer IN consumers[topicName]:
            consumer.Notify(event)
        END FOR
    END LOCK
END FUNCTION

FUNCTION Subscribe(topicName, consumer):
    LOCK:
        consumers[topicName].append(consumer)
    END LOCK
END FUNCTION

FUNCTION Unsubscribe(topicName, consumer):
    LOCK:
        consumers[topicName].remove(consumer)
    END LOCK
END FUNCTION

KEY POINT: Decouples producers (CDC) from consumers (Search, Cache)
Multiple consumers can process same event independently</code></pre>
                        </div>

                        <div class="algorithm-impl">
                            <h5>5ï¸âƒ£ Consumers (Search Index & Cache)</h5>
                            <pre><code>// SEARCH INDEX CONSUMER
STRUCTURE SearchIndexConsumer:
    index: Map<TableName, List<Document>>  // Elasticsearch-like

FUNCTION ProcessEvent(event):
    SWITCH event.operation:
        CASE "INSERT":
            // Add document to search index
            index[event.table].append(event.after)
            
        CASE "UPDATE":
            // Find and update document
            doc = findDocument(event.table, event.after.id)
            updateDocument(doc, event.after)
            
        CASE "DELETE":
            // Remove document from index
            removeDocument(event.table, event.after.id)
    END SWITCH
END FUNCTION


// CACHE CONSUMER
STRUCTURE CacheConsumer:
    cache: Map<Key, Value>  // Redis-like key-value store

FUNCTION ProcessEvent(event):
    key = event.table + ":" + event.after.id
    
    SWITCH event.operation:
        CASE "INSERT", "UPDATE":
            // Upsert in cache
            cache[key] = event.after
            
        CASE "DELETE":
            // Invalidate cache entry
            cache.remove(key)
    END SWITCH
END FUNCTION

KEY POINT: Each consumer processes events independently
Failure in one consumer doesn't affect others</code></pre>
                        </div>

                        <h4>ğŸ“Š Data Flow Example</h4>
                        <div class="algorithm-impl">
                            <pre><code>// USER INSERTS A ROW
database.ExecuteOperation({
    type: "INSERT",
    table: "users",
    data: {id: 123, name: "Alice", email: "alice@example.com"}
})

// â†“ FLOW TIMELINE:

[Time: 0ms] Primary DB
    â””â”€> Row inserted into users table
    â””â”€> LSN incremented: 1000 â†’ 1001

[Time: 0ms] Replication Log
    â””â”€> Entry appended: {lsn: 1001, op: "INSERT", table: "users", ...}

[Time: 100ms] CDC Connector (polls every 100ms)
    â””â”€> Reads log entries where LSN > 1000
    â””â”€> Finds entry 1001

[Time: 100ms] Kafka Broker
    â””â”€> Event published to "db-changes" topic
    â””â”€> Notifies all subscribers

[Time: 100ms] Search Index Consumer
    â””â”€> Receives event
    â””â”€> Indexes user for full-text search
    â””â”€> Alice can now be searched!

[Time: 100ms] Cache Consumer
    â””â”€> Receives event
    â””â”€> Caches user:123 â†’ {name: "Alice", ...}
    â””â”€> Cache is now up-to-date!

[Time: 100ms] âœ… ALL SYSTEMS IN SYNC!

RESULT:
    âœ“ Primary DB: Source of truth (persistent storage)
    âœ“ Search Index: Fast full-text queries
    âœ“ Cache: Ultra-fast key lookups
    âœ“ All updated in ~100ms with zero code changes!</code></pre>
                        </div>

                        <h4>ğŸ¯ Why CDC? (vs Alternatives)</h4>
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Approach</th>
                                    <th>How</th>
                                    <th>Pros</th>
                                    <th>Cons</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Dual Writes</strong></td>
                                    <td>Write to DB + Kafka in code</td>
                                    <td>Simple to implement</td>
                                    <td>âŒ Can fail partially<br>âŒ Not atomic<br>âŒ Code changes needed</td>
                                </tr>
                                <tr>
                                    <td><strong>Polling DB</strong></td>
                                    <td>SELECT * WHERE updated_at > ?</td>
                                    <td>Works with any DB</td>
                                    <td>âŒ Lags behind<br>âŒ Misses deletes<br>âŒ DB overhead</td>
                                </tr>
                                <tr>
                                    <td><strong>CDC (This!)</strong></td>
                                    <td>Read replication log</td>
                                    <td>âœ… No code changes<br>âœ… Captures all changes<br>âœ… Low latency<br>âœ… Guaranteed order</td>
                                    <td>âš ï¸ Requires CDC tool<br>âš ï¸ Complex setup</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>ğŸŒ Real-World CDC Use Cases</h4>
                        <ul>
                            <li><strong>LinkedIn:</strong> Kafka was created for CDC! All DB changes flow through Kafka to derived systems</li>
                            <li><strong>Uber:</strong> Schemaless uses CDC to replicate MySQL â†’ Elasticsearch for fast lookups</li>
                            <li><strong>Netflix:</strong> CDC streams DB changes to data lake for analytics and ML</li>
                            <li><strong>Airbnb:</strong> SpinalTap (CDC tool) keeps search index in sync with MySQL</li>
                            <li><strong>Shopify:</strong> CDC replicates product data to multiple regions and caches</li>
                        </ul>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../session.js"></script>
    <script src="../../theme.js"></script>
    <script src="app.js" defer></script>
</body>
</html>

